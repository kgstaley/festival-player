#!/bin/bash
# script/bootstrap: Resolve all dependencies that the application requires to run.

set -e

cd "$(dirname "$0")/.."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "==> Bootstrapping festival-player..."

# Check for Node.js
if ! command -v node &> /dev/null; then
    echo -e "${RED}Error: Node.js is not installed${NC}"
    echo "Please install Node.js from https://nodejs.org/"
    exit 1
fi

# Check for Yarn
if ! command -v yarn &> /dev/null; then
    echo -e "${RED}Error: Yarn is not installed${NC}"
    echo "Please install Yarn: npm install -g yarn"
    exit 1
fi

echo -e "${GREEN}✓${NC} Node.js $(node --version) found"
echo -e "${GREEN}✓${NC} Yarn $(yarn --version) found"

# Install root dependencies
echo ""
echo "==> Installing root dependencies..."
yarn install

# Install client dependencies
echo ""
echo "==> Installing client dependencies..."
cd client
yarn install
cd ..

# Check for .env file
echo ""
if [ ! -f .env ]; then
    echo -e "${YELLOW}Warning: .env file not found${NC}"
    echo ""
    echo "You need to create a .env file with your Spotify API credentials."
    echo "See script/.env.example for a template."
    echo ""
    echo "Get your credentials at: https://developer.spotify.com/dashboard/applications"
    echo ""
else
    echo -e "${GREEN}✓${NC} .env file found"
fi

echo ""
echo -e "${GREEN}Bootstrap complete!${NC}"
echo ""
echo "Next steps:"
echo "  1. Make sure your .env file is configured (see script/.env.example)"
echo "  2. Run './script/start' to start the development server"
echo "     Or run 'yarn start:dev' if you prefer"
